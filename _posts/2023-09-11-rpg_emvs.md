---
layout: post
title: "RPG_EMVS"
date:   2023-09-11
tags: [default]
comments: true
author: 2c984r83y
---
## Introduction

RPG_EMVS is the implementation of `EMVS: Event-based Multi-View Stereo`.

You can find it [here](https://github.com/uzh-rpg/rpg_emvs/tree/master "github").

## Installation

### Clone the responsity

```bash
cd home\yousa\rosCatkinBuild\src
```

```bash
git clone git@github.com:uzh-rpg/rpg_emvs.git
```

### Run sample

```bash
cd home\yousa\rosCatkinBuild\src\ros_emvc
mkdir sample && cd sample
source /home/yousa/rosCatkinBuild/devel/setup.zsh
rosrun mapper_emvs run_emvs --bag_filename=/home/yousa/dataset/slider_depth.bag --flagfile=/home/yousa/rosCatkinBuild/src/rpg_emvs/mapper_emvs/cfg/slider_depth.conf
```

Output  in terminal:

```
~/rosC/src/rpg_emvs/sample master !1 ?2 ❯ rosrun mapper_emvs run_emvs --bag_filename=/home/yousa/dataset/slider_depth.bag --flagfile=/home/yousa/rosCatkinBuild/src/rpg_emvs/mapper_emvs/cfg/slider_depth.conf
I0911 22:25:17.180009   662 data_loading.cpp:100] Initial stamp: 1461581615.010418917
I0911 22:25:17.287375   662 depth_vector.hpp:133] Using linear spacing in inverse depth
I0911 22:25:17.287421   662 mapper_emvs.cpp:183] Specified DSI FoV < 10 deg. Will use camera FoV instead.
I0911 22:25:17.287426   662 mapper_emvs.cpp:191] Focal length of virtual camera: 328.308 pixels
I0911 22:25:17.503561   662 main.cpp:91] Time to evaluate DSI: 170 milliseconds
I0911 22:25:17.503607   662 main.cpp:92] Number of events processed: 1075290 events
I0911 22:25:17.503614   662 main.cpp:93] Number of events processed per second: 6.32524 Mev/s
I0911 22:25:17.503630   662 main.cpp:95] Mean square = 356.087
I0911 22:25:17.563472   662 main.cpp:142] Saved 2597 data points to pointcloud.pcd
```

In sample:

```python
└── sample
    ├── confidence_map.png
    ├── depth_colored.png
    ├── depth_map.png
    ├── dsi.npy
    ├── pointcloud.pcd
    └── semidense_mask.png
```

### TODO:Visualization

#### Point cloud

Original python script has bug in python3.X, so we use pcl-tools to visualize point cloud.

##### Install pcl-tools:

```bash
sudo apt-get install pcl-tools
```

##### Visualize point cloud:

```bash
pcl_viewer /home/yousa/rosCatkinBuild/src/rpg_emvs/sample/pointcloud.pcd
```

![1694431430873](https://github.com/2c984r83y/2c984r83y.github.io/blob/main/_posts/image/2023-09-11-rpg_emvs/1694431430873.png?raw=true)

#### Disparity Space Image(DSI)

##### ~~Install visvis:~~

```
pip install visvis
```

**~~TODO:Fix bugs~~**

```python
python3 /home/yousa/rosCatkinBuild/src/rpg_emvs/mapper_emvs/scripts/visualize_dsi_volume.py -i /home/yousa/rosCatkinBuild/src/rpg_emvs/sample/dsi.npy
```

```python
python3 /home/yousa/rosCatkinBuild/src/rpg_emvs/mapper_emvs/scripts/visualize_dsi_slices.py -i /home/yousa/rosCatkinBuild/src/rpg_emvs/sample/dsi.npy
```

##### User open3d instead

```bash
pip install open3d
```

```
touch test.py
```

In test.py:

```python
import numpy as np
from open3d import*

source_data = np.load('dsi.npy')  
source_data = source_data.reshape(-1, 3)
point_cloud = open3d.geometry.PointCloud()
point_cloud.points = open3d.utility.Vector3dVector(source_data)
open3d.visualization.draw_geometries([point_cloud])
```

![1694438918169](https://github.com/2c984r83y/2c984r83y.github.io/blob/main/_posts/image/2023-09-11-rpg_emvs/1694438918169.png?raw=true)
